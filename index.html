<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouDJ - YouTube Looper</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    #player { width: 100%; height: 450px; margin: 20px 0; }
    input, button { padding: 8px; margin: 5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>YouDJ</h1>
    <input type="text" id="youtube-url" placeholder="YouTube URL" />
    <input type="number" id="start-time" placeholder="Start time (sec)" />
    <input type="number" id="end-time" placeholder="End time (sec)" />
    <button onclick="loadVideo()">Play Loop</button>
    <div id="player"></div>
  </div>

  <script>
    let player;
    let loopInterval;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      console.log("Player is ready");
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        restartLoop();
      }
    }

    function loadVideo() {
      const url = document.getElementById('youtube-url').value;
      const videoId = extractVideoId(url);
      const startTime = parseFloat(document.getElementById('start-time').value) || 0;
      const endTime = parseFloat(document.getElementById('end-time').value) || 10;

      if (!player) {
        // Загрузка YouTube API динамически, если не подключено
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);
        
        window.onYouTubeIframeAPIReady = function() {
          player = new YT.Player('player', {
            videoId: videoId,
            playerVars: {
              start: startTime,
              end: endTime
            },
            events: {
              'onReady': onPlayerReady,
              'onStateChange': onPlayerStateChange
            }
          });
        };
      } else {
        player.loadVideoById({
          videoId: videoId,
          startSeconds: startTime,
          endSeconds: endTime
        });
      }
    }

    function restartLoop() {
      const startTime = parseFloat(document.getElementById('start-time').value) || 0;
      player.seekTo(startTime);
      player.playVideo();
    }

    function extractVideoId(url) {
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? match[2] : null;
    }
  </script>
</body>
</html>
